(()=>{"use strict";var t={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},e=document.querySelector(".cards"),n=document.querySelector(".profile"),r=n.querySelector(".user__avatar"),o=n.querySelector(".user__name"),c=n.querySelector(".user__status"),a=document.querySelector(".add-card-button"),u=document.querySelector(".user__edit-button"),i=document.querySelector(".user__avatar-overlay"),l=document.querySelector(".popup_type_profile"),s=document.forms.editProfile,d=s.elements.userName,f=s.elements.userStatus,m=s.querySelector(".form__submit-button"),v=document.querySelector(".popup_type_add-card"),p=document.forms.addCard,_=p.elements.cardTitle,y=p.elements.cardImage,b=p.querySelector(".form__submit-button"),S=document.querySelector(".popup_type_card"),h=S.querySelector(".popup__image"),g=S.querySelector(".popup__caption"),C=document.querySelector(".popup_type_edit-user-avatar"),E=document.forms.editUserAvatar,L=E.elements.userAvatarLink,q=E.querySelector(".form__submit-button");var k,x,A,O=function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),o.classList.remove(r),o.textContent=""},j=function(t,e){t.disabled=!0,t.classList.add(e)},w=function(t,e,n,r){var o=t.querySelector(r);!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?function(t,e){t.disabled=!1,t.classList.remove(e)}(o,n):j(o,n)},T=function(t,e){var n=e.submitButtonSelector,r=e.inputErrorClass,o=e.inactiveButtonClass,c=e.errorClass,a=Array.from(t.querySelectorAll(".form__input")),u=t.querySelector(n);a.forEach((function(e){O(t,e,r,c),j(u,o)}))},P={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-20"),headers:{authorization:"683f3065-4a13-441a-ad8e-6cb61f200f4c","Content-Type":"application/json"}},B=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},D=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch("".concat(P.baseUrl,"/").concat(t),{method:e,headers:P.headers,body:n}).then(B)},I=function(){return D("users/me","GET")},N=function(t,e,n,r,o,c,a,u,i){var l=document.querySelector(t).content.querySelector(e).cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__title"),f=l.querySelector(".card__like-button"),m=l.querySelector(".card__delete-button"),v=l.querySelector(".card__like-counter");return s.src=r,s.alt=n,d.textContent=n,v.textContent=i.length,s.addEventListener("click",o),function(t,e,n){t.forEach((function(t){t._id===n?e.classList.add("card__like-button_active"):e.classList.remove("card__like-button_active")}))}(i,f,a),function(t,e,n){e!==n&&t.classList.add("card__delete-button_disabled")}(m,u,a),function(t,e,n,r){t.addEventListener("click",(function(){t.classList.contains("card__like-button_active")?function(t,e,n){(function(t){return D("cards/likes/".concat(t),"DELETE")})(e).then((function(e){t.classList.remove("card__like-button_active"),n.textContent=e.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(t,e,n):function(t,e,n){(function(t){return D("cards/likes/".concat(t),"PUT")})(e).then((function(e){t.classList.add("card__like-button_active"),n.textContent=e.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(t,e,n)}))}(f,c,v),function(t,e){t.addEventListener("click",(function(){(function(t){return D("cards/".concat(t),"DELETE")})(e).then((function(){t.closest(".card").remove()})).catch((function(t){console.log("Ошибка: ".concat(t))}))}))}(m,c),l},U=function(t,e){t.prepend(e)},M=function(t){t.classList.add("popup_opened"),t.addEventListener("mousedown",H),document.addEventListener("keydown",H)},J=function(t){t.classList.remove("popup_opened"),t.removeEventListener("mousedown",H),document.removeEventListener("keydown",H)},G=function(t){!function(t,e,n){e.src=t.target.src,e.alt=t.target.alt,n.textContent=t.target.alt}(t,h,g),M(S)},H=function(t){t.target.classList.contains("popup__close-button")||t.target.classList.contains("popup")?J(t.target.closest(".popup")):"Escape"===t.key&&J(document.querySelector(".popup_opened"))};function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Promise.all([I(),D("cards","GET")]).then((function(t){var n=V(t,2),a=n[0],u=n[1];a._id,o.textContent=a.name,c.textContent=a.about,r.src=a.avatar,u.reverse(),u.forEach((function(t){U(e,N(".card-template",".card",t.name,t.link,G,t._id,a._id,t.owner._id,t.likes))}))})).catch((function(t){console.log("Ошибка: ".concat(t))})),u.addEventListener("click",(function(){d.value=o.textContent,f.value=c.textContent,T(s,t),M(l)})),a.addEventListener("click",(function(){T(p,t),p.reset(),M(v)})),i.addEventListener("click",(function(){T(E,t),E.reset(),M(C)})),p.addEventListener("submit",(function(t){var n,r,o;t.preventDefault(),b.textContent="Сохранение...",Promise.all([I(),(n=_.value,r=y.value,o=JSON.stringify({name:n,link:r}),D("cards","POST",o))]).then((function(t){var n=V(t,2),r=n[0],o=n[1];U(e,N(".card-template",".card",_.value,y.value,G,o._id,r._id,o.owner._id,o.likes)),J(v),p.reset()})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){b.textContent="Создать"}))})),s.addEventListener("submit",(function(t){var e,n,r;t.preventDefault(),m.textContent="Сохранение...",(e=d.value,n=f.value,r=JSON.stringify({name:e,about:n}),D("users/me","PATCH",r)).then((function(){o.textContent=d.value,c.textContent=f.value,J(l)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){m.textContent="Сохранить"}))})),E.addEventListener("submit",(function(t){var e,n;t.preventDefault(),q.textContent="Сохранение",(e=L.value,n=JSON.stringify({avatar:e}),D("users/me/avatar","PATCH",n)).then((function(){r.src=L.value,J(C)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){q.textContent="Сохранить"}))})),x=(k=t).formSelector,A=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},c=Object.keys(t);for(r=0;r<c.length;r++)n=c[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(r=0;r<c.length;r++)n=c[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(k,["formSelector"]),Array.from(document.querySelectorAll(x)).forEach((function(t){!function(t,e){var n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,c=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(n));w(t,u,o,r),u.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?O(t,e,n,r):function(t,e,n,r,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),c.classList.add(r),c.textContent=o}(t,e,n,r,e.validationMessage)}(t,e,c,a),w(t,u,o,r)}))}))}(t,A)}))})();