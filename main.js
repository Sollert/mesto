(()=>{"use strict";var t={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},e=document.querySelector(".cards"),n=document.querySelector(".profile"),r=n.querySelector(".user__avatar"),o=n.querySelector(".user__name"),c=n.querySelector(".user__status"),a=document.querySelector(".add-card-button"),u=document.querySelector(".user__edit-button"),i=document.querySelector(".user__avatar-overlay"),l=document.querySelector(".popup_type_profile"),s=document.forms.editProfile,d=s.elements.userName,f=s.elements.userStatus,m=s.querySelector(".form__submit-button"),v=document.querySelector(".popup_type_add-card"),p=document.forms.addCard,y=p.elements.cardTitle,_=p.elements.cardImage,b=p.querySelector(".form__submit-button"),S=document.querySelector(".popup_type_card"),h=S.querySelector(".popup__image"),C=S.querySelector(".popup__caption"),q=document.querySelector(".popup_type_edit-user-avatar"),E=document.forms.editUserAvatar,L=E.elements.userAvatarLink,g=E.querySelector(".form__submit-button");var k,x=function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),o.classList.remove(r),o.textContent=""},A=function(t,e){t.disabled=!0,t.classList.add(e)},O=function(t,e,n,r){var o=t.querySelector(r);!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?function(t,e){t.disabled=!1,t.classList.remove(e)}(o,n):A(o,n)},j=function(t,e){var n=e.submitButtonSelector,r=e.inputErrorClass,o=e.inactiveButtonClass,c=e.errorClass,a=Array.from(t.querySelectorAll(".form__input")),u=t.querySelector(n);a.forEach((function(e){x(t,e,r,c),A(u,o)}))},w={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-20"),headers:{authorization:"683f3065-4a13-441a-ad8e-6cb61f200f4c","Content-Type":"application/json"}},T=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},P=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch("".concat(w.baseUrl,"/").concat(t),{method:e,headers:w.headers,body:n}).then(T)},B=function(t,e,n,r,o,c,a,u,i,l,s){var d=document.querySelector(t).content.querySelector(e).cloneNode(!0),f=d.querySelector(".card__image"),m=d.querySelector(".card__title"),v=d.querySelector(".card__like-button"),p=d.querySelector(".card__delete-button"),y=d.querySelector(".card__like-counter"),_=function(t,e){return t.some((function(t){return t._id===e}))}(s,i);return f.src=r,f.alt=n,m.textContent=n,y.textContent=s.length,function(t,e,n){e!==n&&t.classList.add("card__delete-button_disabled")}(p,l,i),function(t,e){t?e.classList.add("card__like-button_active"):e.classList.remove("card__like-button_active")}(_,v),v.addEventListener("click",(function(){a(_,v,u,y),_=!_})),p.addEventListener("click",(function(){c(p,u)})),f.addEventListener("click",(function(){o(r,n)})),d},D=function(t,e){t.prepend(e)},I=function(t){t.classList.add("popup_opened"),t.addEventListener("mousedown",M),document.addEventListener("keydown",M)},N=function(t){t.classList.remove("popup_opened"),t.removeEventListener("mousedown",M),document.removeEventListener("keydown",M)},U=function(t,e){!function(t,e){h.src=t,h.alt=e,C.textContent=e}(t,e),I(S)},M=function(t){t.target.classList.contains("popup__close-button")||t.target.classList.contains("popup")?N(t.target.closest(".popup")):"Escape"===t.key&&N(document.querySelector(".popup_opened"))};function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var G,H,V,z=function(t,e){(function(t){return P("cards/".concat(t),"DELETE")})(e).then((function(){!function(t){t.closest(".card").remove()}(t)})).catch((function(t){console.log("Ошибка: ".concat(t))}))},$=function(t,e,n,r){t?function(t){return P("cards/likes/".concat(t),"DELETE")}(n).then((function(t){!function(t,e,n){e.classList.remove("card__like-button_active"),n.textContent=t.likes.length}(t,e,r)})):function(t){return P("cards/likes/".concat(t),"PUT")}(n).then((function(t){!function(t,e,n){e.classList.add("card__like-button_active"),n.textContent=t.likes.length}(t,e,r)}))};Promise.all([P("users/me","GET"),P("cards","GET")]).then((function(t){var n,a,u=(a=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(n,a)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(t,e):void 0}}(n,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=u[0],l=u[1];k=i._id,o.textContent=i.name,c.textContent=i.about,r.src=i.avatar,l.reverse(),l.forEach((function(t){D(e,B(".card-template",".card",t.name,t.link,U,z,$,t._id,i._id,t.owner._id,t.likes))}))})).catch((function(t){console.log("Ошибка: ".concat(t))})),u.addEventListener("click",(function(){d.value=o.textContent,f.value=c.textContent,j(s,t),I(l)})),a.addEventListener("click",(function(){j(p,t),p.reset(),I(v)})),i.addEventListener("click",(function(){j(E,t),E.reset(),I(q)})),p.addEventListener("submit",(function(t){var n,r,o;t.preventDefault(),b.textContent="Сохранение...",(n=y.value,r=_.value,o=JSON.stringify({name:n,link:r}),P("cards","POST",o)).then((function(t){D(e,B(".card-template",".card",y.value,_.value,U,z,$,t._id,k,t.owner._id,t.likes)),N(v),p.reset()})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){b.textContent="Создать"}))})),s.addEventListener("submit",(function(t){var e,n,r;t.preventDefault(),m.textContent="Сохранение...",(e=d.value,n=f.value,r=JSON.stringify({name:e,about:n}),P("users/me","PATCH",r)).then((function(){o.textContent=d.value,c.textContent=f.value,N(l)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){m.textContent="Сохранить"}))})),E.addEventListener("submit",(function(t){var e,n;t.preventDefault(),g.textContent="Сохранение",(e=L.value,n=JSON.stringify({avatar:e}),P("users/me/avatar","PATCH",n)).then((function(){r.src=L.value,N(q)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){g.textContent="Сохранить"}))})),H=(G=t).formSelector,V=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},c=Object.keys(t);for(r=0;r<c.length;r++)n=c[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(r=0;r<c.length;r++)n=c[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(G,["formSelector"]),Array.from(document.querySelectorAll(H)).forEach((function(t){!function(t,e){var n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,c=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(n));O(t,u,o,r),u.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?x(t,e,n,r):function(t,e,n,r,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),c.classList.add(r),c.textContent=o}(t,e,n,r,e.validationMessage)}(t,e,c,a),O(t,u,o,r)}))}))}(t,V)}))})();